(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2333],{2333:(C,$,m)=>{"use strict";m.d($,{e:()=>h});var S=m(5861),I=m(1450),ee=m(46),K=m(5619),L=m(553),z=m(6689),B=m(8828);let h=(()=>{var D;class te{constructor(w){this.router=w,this.currentUser=new K.X(null),this.initialized=!1,console.log("initialized",this.initialized),this.supabase=(0,ee.eI)(L.N.supabaseUrl,L.N.supabaseKey),this.supabase.auth.onAuthStateChange((x,re)=>{"SIGNED_IN"===x||"TOKEN_REFRESHED"===x?(this.currentUser.next(re.user),this.userId=this.getCurrentUserId()):this.currentUser.next(!1)}),this.loadUser(),console.log("initialized",this.initialized)}loadUser(){var w=this;return(0,S.Z)(function*(){if(w.currentUser.value)return;const x=yield w.supabase.auth.getUser();w.currentUser.next(!!x.data.user&&x.data.user)})()}signUp(w){return this.supabase.auth.signUp(w)}signIn(w){return this.supabase.auth.signInWithPassword(w)}signInWithEmail(w){const x=(0,I.n$)("capacitor")?"registrapp://login":`${window.location.origin}/student/tabs/tab1`;return console.log("set redirect: ",x),this.supabase.auth.signInWithOtp({email:w,options:{emailRedirectTo:x}})}sendPwReset(w){return this.supabase.auth.resetPasswordForEmail(w,{redirectTo:`${window.location.origin}/password-recovery`})}updatePassword(w){return this.supabase.auth.updateUser({password:w.password})}signOut(){var w=this;return(0,S.Z)(function*(){yield w.supabase.auth.signOut(),w.router.navigateByUrl("/",{replaceUrl:!0})})()}getCurrentUser(){return this.currentUser.asObservable()}getCurrentUserId(){return this.currentUser.value?this.currentUser.value.id:null}setSession(w,x){var re=this;return(0,S.Z)(function*(){return re.supabase.auth.setSession({access_token:w,refresh_token:x})})()}setInizializedToTrue(){this.initialized=!0}setInizializedToFalse(){this.initialized=!1}}return(D=te).\u0275fac=function(w){return new(w||D)(z.LFG(B.F0))},D.\u0275prov=z.Yz7({token:D,factory:D.\u0275fac,providedIn:"root"}),te})()},9470:(C,$)=>{"use strict";var S=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}();C.exports=$=S.fetch,S.fetch&&($.default=S.fetch.bind(S)),$.Headers=S.Headers,$.Request=S.Request,$.Response=S.Response},46:(C,$,m)=>{"use strict";m.d($,{eI:()=>Tr});class I extends Error{constructor(r,e="FunctionsError",t){super(r),this.name=e,this.context=t}}class ee extends I{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class K extends I{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class L extends I{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}class B{constructor(r,{headers:e={},customFetch:t}={}){this.url=r,this.headers=e,this.fetch=(i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(m.t.bind(m,9470,23)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)})(t)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r,e={}){var t;return function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})}(this,void 0,void 0,function*(){try{const{headers:n,method:s,body:o}=e;let c,a={};o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=o):"string"==typeof o?(a["Content-Type"]="text/plain",c=o):typeof FormData<"u"&&o instanceof FormData?c=o:(a["Content-Type"]="application/json",c=JSON.stringify(o)));const u=yield this.fetch(`${this.url}/${r}`,{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),n),body:c}).catch(g=>{throw new ee(g)}),l=u.headers.get("x-relay-error");if(l&&"true"===l)throw new K(u);if(!u.ok)throw new L(u);let _,d=(null!==(t=u.headers.get("Content-Type"))&&void 0!==t?t:"text/plain").split(";")[0].trim();return _="application/json"===d?yield u.json():"application/octet-stream"===d?yield u.blob():"multipart/form-data"===d?yield u.formData():yield u.text(),{data:_,error:null}}catch(n){return{data:null,error:n}}})}}var h=m(5861),D=m(9470),te=m.n(D);class pe{constructor(r){this.shouldThrowOnError=!1,this.method=r.method,this.url=r.url,this.headers=r.headers,this.schema=r.schema,this.body=r.body,this.shouldThrowOnError=r.shouldThrowOnError,this.signal=r.signal,this.isMaybeSingle=r.isMaybeSingle,this.fetch=r.fetch?r.fetch:typeof fetch>"u"?te():fetch}throwOnError(){return this.shouldThrowOnError=!0,this}then(r,e){var t=this;void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(function(){var o=(0,h.Z)(function*(a){var c,u,l;let d=null,_=null,g=null,f=a.status,p=a.statusText;if(a.ok){if("HEAD"!==t.method){const P=yield a.text();""===P||(_="text/csv"===t.headers.Accept||t.headers.Accept&&t.headers.Accept.includes("application/vnd.pgrst.plan+text")?P:JSON.parse(P))}const O=null===(c=t.headers.Prefer)||void 0===c?void 0:c.match(/count=(exact|planned|estimated)/),E=null===(u=a.headers.get("content-range"))||void 0===u?void 0:u.split("/");O&&E&&E.length>1&&(g=parseInt(E[1])),t.isMaybeSingle&&"GET"===t.method&&Array.isArray(_)&&(_.length>1?(d={code:"PGRST116",details:`Results contain ${_.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},_=null,g=null,f=406,p="Not Acceptable"):_=1===_.length?_[0]:null)}else{const O=yield a.text();try{d=JSON.parse(O),Array.isArray(d)&&404===a.status&&(_=[],d=null,f=200,p="OK")}catch{404===a.status&&""===O?(f=204,p="No Content"):d={message:O}}if(d&&t.isMaybeSingle&&!(null===(l=null==d?void 0:d.details)||void 0===l)&&l.includes("Results contain 0 rows")&&(d=null,f=200,p="OK"),d&&t.shouldThrowOnError)throw d}return{error:d,data:_,count:g,status:f,statusText:p}});return function(a){return o.apply(this,arguments)}}());return this.shouldThrowOnError||(s=s.catch(o=>{var a,c,u;return{error:{message:`${null!==(a=null==o?void 0:o.name)&&void 0!==a?a:"FetchError"}: ${null==o?void 0:o.message}`,details:`${null!==(c=null==o?void 0:o.stack)&&void 0!==c?c:""}`,hint:"",code:`${null!==(u=null==o?void 0:o.code)&&void 0!==u?u:""}`},data:null,count:null,status:0,statusText:""}})),s.then(r,e)}}class w extends pe{select(r){let e=!1;const t=(null!=r?r:"*").split("").map(n=>/\s/.test(n)&&!e?"":('"'===n&&(e=!e),n)).join("");return this.url.searchParams.set("select",t),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(r,{ascending:e=!0,nullsFirst:t,foreignTable:n}={}){const s=n?`${n}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${r}.${e?"asc":"desc"}${void 0===t?"":t?".nullsfirst":".nullslast"}`),this}limit(r,{foreignTable:e}={}){return this.url.searchParams.set(typeof e>"u"?"limit":`${e}.limit`,`${r}`),this}range(r,e,{foreignTable:t}={}){const s=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(typeof t>"u"?"offset":`${t}.offset`,`${r}`),this.url.searchParams.set(s,""+(e-r+1)),this}abortSignal(r){return this.signal=r,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.headers.Accept="GET"===this.method?"application/json":"application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:r=!1,verbose:e=!1,settings:t=!1,buffers:n=!1,wal:s=!1,format:o="text"}={}){const a=[r?"analyze":null,e?"verbose":null,t?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|");return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${this.headers.Accept}"; options=${a};`,this}rollback(){var r;return(null!==(r=this.headers.Prefer)&&void 0!==r?r:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}class x extends w{eq(r,e){return this.url.searchParams.append(r,`eq.${e}`),this}neq(r,e){return this.url.searchParams.append(r,`neq.${e}`),this}gt(r,e){return this.url.searchParams.append(r,`gt.${e}`),this}gte(r,e){return this.url.searchParams.append(r,`gte.${e}`),this}lt(r,e){return this.url.searchParams.append(r,`lt.${e}`),this}lte(r,e){return this.url.searchParams.append(r,`lte.${e}`),this}like(r,e){return this.url.searchParams.append(r,`like.${e}`),this}likeAllOf(r,e){return this.url.searchParams.append(r,`like(all).{${e.join(",")}}`),this}likeAnyOf(r,e){return this.url.searchParams.append(r,`like(any).{${e.join(",")}}`),this}ilike(r,e){return this.url.searchParams.append(r,`ilike.${e}`),this}ilikeAllOf(r,e){return this.url.searchParams.append(r,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(r,e){return this.url.searchParams.append(r,`ilike(any).{${e.join(",")}}`),this}is(r,e){return this.url.searchParams.append(r,`is.${e}`),this}in(r,e){const t=e.map(n=>"string"==typeof n&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(r,`in.(${t})`),this}contains(r,e){return"string"==typeof e?this.url.searchParams.append(r,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cs.{${e.join(",")}}`):this.url.searchParams.append(r,`cs.${JSON.stringify(e)}`),this}containedBy(r,e){return"string"==typeof e?this.url.searchParams.append(r,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(r,`cd.{${e.join(",")}}`):this.url.searchParams.append(r,`cd.${JSON.stringify(e)}`),this}rangeGt(r,e){return this.url.searchParams.append(r,`sr.${e}`),this}rangeGte(r,e){return this.url.searchParams.append(r,`nxl.${e}`),this}rangeLt(r,e){return this.url.searchParams.append(r,`sl.${e}`),this}rangeLte(r,e){return this.url.searchParams.append(r,`nxr.${e}`),this}rangeAdjacent(r,e){return this.url.searchParams.append(r,`adj.${e}`),this}overlaps(r,e){return this.url.searchParams.append(r,"string"==typeof e?`ov.${e}`:`ov.{${e.join(",")}}`),this}textSearch(r,e,{config:t,type:n}={}){let s="";return"plain"===n?s="pl":"phrase"===n?s="ph":"websearch"===n&&(s="w"),this.url.searchParams.append(r,`${s}fts${void 0===t?"":`(${t})`}.${e}`),this}match(r){return Object.entries(r).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(r,e,t){return this.url.searchParams.append(r,`not.${e}.${t}`),this}or(r,{foreignTable:e}={}){return this.url.searchParams.append(e?`${e}.or`:"or",`(${r})`),this}filter(r,e,t){return this.url.searchParams.append(r,`${e}.${t}`),this}}class re{constructor(r,{headers:e={},schema:t,fetch:n}){this.url=r,this.headers=e,this.schema=t,this.fetch=n}select(r,{head:e=!1,count:t}={}){const n=e?"HEAD":"GET";let s=!1;const o=(null!=r?r:"*").split("").map(a=>/\s/.test(a)&&!s?"":('"'===a&&(s=!s),a)).join("");return this.url.searchParams.set("select",o),t&&(this.headers.Prefer=`count=${t}`),new x({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(r,{count:e,defaultToNull:t=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),e&&s.push(`count=${e}`),t||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(r)){const o=r.reduce((a,c)=>a.concat(Object.keys(c)),[]);if(o.length>0){const a=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",a.join(","))}}return new x({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}upsert(r,{onConflict:e,ignoreDuplicates:t=!1,count:n,defaultToNull:s=!0}={}){const a=[`resolution=${t?"ignore":"merge"}-duplicates`];if(void 0!==e&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),n&&a.push(`count=${n}`),s||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(r)){const c=r.reduce((u,l)=>u.concat(Object.keys(l)),[]);if(c.length>0){const u=[...new Set(c)].map(l=>`"${l}"`);this.url.searchParams.set("columns",u.join(","))}}return new x({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}update(r,{count:e}={}){const n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),e&&n.push(`count=${e}`),this.headers.Prefer=n.join(","),new x({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:r,fetch:this.fetch,allowEmpty:!1})}delete({count:r}={}){const t=[];return r&&t.push(`count=${r}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new x({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}const it={"X-Client-Info":"postgrest-js/1.8.4"};class ve{constructor(r,{headers:e={},schema:t,fetch:n}={}){this.url=r,this.headers=Object.assign(Object.assign({},it),e),this.schemaName=t,this.fetch=n}from(r){const e=new URL(`${this.url}/${r}`);return new re(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(r){return new ve(this.url,{headers:this.headers,schema:r,fetch:this.fetch})}rpc(r,e={},{head:t=!1,count:n}={}){let s;const o=new URL(`${this.url}/rpc/${r}`);let a;t?(s="HEAD",Object.entries(e).forEach(([u,l])=>{o.searchParams.append(u,`${l}`)})):(s="POST",a=e);const c=Object.assign({},this.headers);return n&&(c.Prefer=`count=${n}`),new x({method:s,url:o,headers:c,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}}var ot=m(6624);const at={"X-Client-Info":"realtime-js/2.7.4"};var ue=function(i){return i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed",i}(ue||{}),A=function(i){return i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving",i}(A||{}),U=function(i){return i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token",i}(U||{}),Fe=function(i){return i.websocket="websocket",i}(Fe||{}),G=function(i){return i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed",i}(G||{});class Ne{constructor(r,e){this.callback=r,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}class ut{constructor(){this.HEADER_LENGTH=1}decode(r,e){return r.constructor===ArrayBuffer?e(this._binaryDecode(r)):e("string"==typeof r?JSON.parse(r):{})}_binaryDecode(r){const e=new DataView(r),t=new TextDecoder;return this._decodeBroadcast(r,e,t)}_decodeBroadcast(r,e,t){const n=e.getUint8(1),s=e.getUint8(2);let o=this.HEADER_LENGTH+2;const a=t.decode(r.slice(o,o+n));o+=n;const c=t.decode(r.slice(o,o+s));return o+=s,{ref:null,topic:a,event:c,payload:JSON.parse(t.decode(r.slice(o,r.byteLength)))}}}class ye{constructor(r,e,t={},n=1e4){this.channel=r,this.event=e,this.payload=t,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null,this.rateLimited=!1}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,"rate limited"===this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()})&&(this.rateLimited=!0))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,e){var t;return this._hasReceived(r)&&e(null===(t=this.receivedResp)||void 0===t?void 0:t.response),this.recHooks.push({status:r,callback:e}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(r,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:e}){this.recHooks.filter(t=>t.status===r).forEach(t=>t.callback(e))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}class ne{constructor(r,e){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const t=(null==e?void 0:e.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(t.state,{},n=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ne.syncState(this.state,n,s,o),this.pendingDiffs.forEach(c=>{this.state=ne.syncDiff(this.state,c,s,o)}),this.pendingDiffs=[],a()}),this.channel._on(t.diff,{},n=>{const{onJoin:s,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=ne.syncDiff(this.state,n,s,o),a())}),this.onJoin((n,s,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:s,newPresences:o})}),this.onLeave((n,s,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,e,t,n){const s=this.cloneDeep(r),o=this.transformState(e),a={},c={};return this.map(s,(u,l)=>{o[u]||(c[u]=l)}),this.map(o,(u,l)=>{const d=s[u];if(d){const _=l.map(b=>b.presence_ref),g=d.map(b=>b.presence_ref),f=l.filter(b=>g.indexOf(b.presence_ref)<0),p=d.filter(b=>_.indexOf(b.presence_ref)<0);f.length>0&&(a[u]=f),p.length>0&&(c[u]=p)}else a[u]=l}),this.syncDiff(s,{joins:a,leaves:c},t,n)}static syncDiff(r,e,t,n){const{joins:s,leaves:o}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return t||(t=()=>{}),n||(n=()=>{}),this.map(s,(a,c)=>{var u;const l=null!==(u=r[a])&&void 0!==u?u:[];if(r[a]=this.cloneDeep(c),l.length>0){const d=r[a].map(g=>g.presence_ref),_=l.filter(g=>d.indexOf(g.presence_ref)<0);r[a].unshift(..._)}t(a,l,c)}),this.map(o,(a,c)=>{let u=r[a];if(!u)return;const l=c.map(d=>d.presence_ref);u=u.filter(d=>l.indexOf(d.presence_ref)<0),r[a]=u,n(a,u,c),0===u.length&&delete r[a]}),r}static map(r,e){return Object.getOwnPropertyNames(r).map(t=>e(t,r[t]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((e,t)=>{const n=r[t];return e[t]="metas"in n?n.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n,e},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var k=function(i){return i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange",i}(k||{});const Me=(i,r,e={})=>{var t;const n=null!==(t=e.skipTypes)&&void 0!==t?t:[];return Object.keys(r).reduce((s,o)=>(s[o]=dt(o,i,r,n),s),{})},dt=(i,r,e,t)=>{const n=r.find(a=>a.name===i),s=null==n?void 0:n.type,o=e[i];return s&&!t.includes(s)?ze(s,o):me(o)},ze=(i,r)=>{if("_"===i.charAt(0)){const e=i.slice(1,i.length);return pt(r,e)}switch(i){case k.bool:return ft(r);case k.float4:case k.float8:case k.int2:case k.int4:case k.int8:case k.numeric:case k.oid:return _t(r);case k.json:case k.jsonb:return gt(r);case k.timestamp:return vt(r);default:return me(r)}},me=i=>i,ft=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},_t=i=>{if("string"==typeof i){const r=parseFloat(i);if(!Number.isNaN(r))return r}return i},gt=i=>{if("string"==typeof i)try{return JSON.parse(i)}catch(r){return console.log(`JSON parse error: ${r}`),i}return i},pt=(i,r)=>{if("string"!=typeof i)return i;const e=i.length-1;if("{"===i[0]&&"}"===i[e]){let s;const o=i.slice(1,e);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(a=>ze(r,a))}return i},vt=i=>"string"==typeof i?i.replace(" ","T"):i;var Be=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})};class be{constructor(r,e={config:{}},t){this.topic=r,this.params=e,this.socket=t,this.bindings={},this.state=A.closed,this.joinedOnce=!1,this.pushBuffer=[],this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""}},e.config),this.timeout=this.socket.timeout,this.joinPush=new ye(this,U.join,this.params,this.timeout),this.rejoinTimer=new Ne(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=A.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=A.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=A.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=A.errored,this.rejoinTimer.scheduleTimeout())}),this._on(U.reply,{},(n,s)=>{this._trigger(this._replyEventName(s),n)}),this.presence=new ne(this)}subscribe(r,e=this.timeout){var t,n;if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:s,presence:o}}=this.params;this._onError(u=>r&&r("CHANNEL_ERROR",u)),this._onClose(()=>r&&r("CLOSED"));const a={},c={broadcast:s,presence:o,postgres_changes:null!==(n=null===(t=this.bindings.postgres_changes)||void 0===t?void 0:t.map(u=>u.filter))&&void 0!==n?n:[]};this.socket.accessToken&&(a.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:c},a)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",({postgres_changes:u})=>{var l;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==u){const d=this.bindings.postgres_changes,_=null!==(l=null==d?void 0:d.length)&&void 0!==l?l:0,g=[];for(let f=0;f<_;f++){const p=d[f],{filter:{event:b,schema:O,table:E,filter:P}}=p,j=u&&u[f];if(!j||j.event!==b||j.schema!==O||j.table!==E||j.filter!==P)return this.unsubscribe(),void(r&&r("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));g.push(Object.assign(Object.assign({},p),{id:j.id}))}return this.bindings.postgres_changes=g,void(r&&r("SUBSCRIBED"))}r&&r("SUBSCRIBED")}).receive("error",u=>{r&&r("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{r&&r("TIMED_OUT")})}return this}presenceState(){return this.presence.state}track(r,e={}){return Be(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"track",payload:r},e.timeout||this.timeout)})}untrack(r={}){return Be(this,void 0,void 0,function*(){return yield this.send({type:"presence",event:"untrack"},r)})}on(r,e,t){return this._on(r,e,t)}send(r,e={}){return new Promise(t=>{var n,s,o;const a=this._push(r.type,r,e.timeout||this.timeout);a.rateLimited&&t("rate limited"),"broadcast"===r.type&&!(null!==(o=null===(s=null===(n=this.params)||void 0===n?void 0:n.config)||void 0===s?void 0:s.broadcast)&&void 0!==o&&o.ack)&&t("ok"),a.receive("ok",()=>t("ok")),a.receive("timeout",()=>t("timed out"))})}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=A.leaving;const e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(U.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(t=>{const n=new ye(this,U.leave,{},r);n.receive("ok",()=>{e(),t("ok")}).receive("timeout",()=>{e(),t("timed out")}).receive("error",()=>{t("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}_push(r,e,t=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new ye(this,r,e,t);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(r,e,t){return e}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,e,t){var n,s;const o=r.toLocaleLowerCase(),{close:a,error:c,leave:u,join:l}=U;if(t&&[a,c,u,l].indexOf(o)>=0&&t!==this._joinRef())return;let _=this._onMessage(o,e,t);if(e&&!_)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?null===(n=this.bindings.postgres_changes)||void 0===n||n.filter(g=>{var f,p,b;return"*"===(null===(f=g.filter)||void 0===f?void 0:f.event)||(null===(b=null===(p=g.filter)||void 0===p?void 0:p.event)||void 0===b?void 0:b.toLocaleLowerCase())===o}).map(g=>g.callback(_,t)):null===(s=this.bindings[o])||void 0===s||s.filter(g=>{var f,p,b,O,E,P;if(["broadcast","presence","postgres_changes"].includes(o)){if("id"in g){const j=g.id,J=null===(f=g.filter)||void 0===f?void 0:f.event;return j&&(null===(p=e.ids)||void 0===p?void 0:p.includes(j))&&("*"===J||(null==J?void 0:J.toLocaleLowerCase())===(null===(b=e.data)||void 0===b?void 0:b.type.toLocaleLowerCase()))}{const j=null===(E=null===(O=null==g?void 0:g.filter)||void 0===O?void 0:O.event)||void 0===E?void 0:E.toLocaleLowerCase();return"*"===j||j===(null===(P=null==e?void 0:e.event)||void 0===P?void 0:P.toLocaleLowerCase())}}return g.type.toLocaleLowerCase()===o}).map(g=>{if("object"==typeof _&&"ids"in _){const f=_.data,{schema:p,table:b,commit_timestamp:O,type:E,errors:P}=f;_=Object.assign(Object.assign({},{schema:p,table:b,commit_timestamp:O,eventType:E,new:{},old:{},errors:P}),this._getPayloadRecords(f))}g.callback(_,t)})}_isClosed(){return this.state===A.closed}_isJoined(){return this.state===A.joined}_isJoining(){return this.state===A.joining}_isLeaving(){return this.state===A.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,e,t){const n=r.toLocaleLowerCase(),s={type:n,filter:e,callback:t};return this.bindings[n]?this.bindings[n].push(s):this.bindings[n]=[s],this}_off(r,e){const t=r.toLocaleLowerCase();return this.bindings[t]=this.bindings[t].filter(n=>{var s;return!((null===(s=n.type)||void 0===s?void 0:s.toLocaleLowerCase())===t&&be.isEqual(n.filter,e))}),this}static isEqual(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(r[t]!==e[t])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(U.close,{},r)}_onError(r){this._on(U.error,{},e=>r(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=A.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const e={new:{},old:{}};return("INSERT"===r.type||"UPDATE"===r.type)&&(e.new=Me(r.columns,r.record)),("UPDATE"===r.type||"DELETE"===r.type)&&(e.old=Me(r.columns,r.old_record)),e}}var we=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})};const wt=()=>{};class kt{constructor(r,e){var t,n;this.accessToken=null,this.channels=[],this.endPoint="",this.headers=at,this.params={},this.timeout=1e4,this.transport=ot.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=wt,this.conn=null,this.sendBuffer=[],this.serializer=new ut,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.eventsPerSecondLimitMs=100,this.inThrottle=!1,this.endPoint=`${r}/${Fe.websocket}`,null!=e&&e.params&&(this.params=e.params),null!=e&&e.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),null!=e&&e.timeout&&(this.timeout=e.timeout),null!=e&&e.logger&&(this.logger=e.logger),null!=e&&e.transport&&(this.transport=e.transport),null!=e&&e.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);const s=null===(t=null==e?void 0:e.params)||void 0===t?void 0:t.eventsPerSecond;s&&(this.eventsPerSecondLimitMs=Math.floor(1e3/s));const o=null===(n=null==e?void 0:e.params)||void 0===n?void 0:n.apikey;o&&(this.accessToken=o),this.reconnectAfterMs=null!=e&&e.reconnectAfterMs?e.reconnectAfterMs:a=>[1e3,2e3,5e3,1e4][a-1]||1e4,this.encode=null!=e&&e.encode?e.encode:(a,c)=>c(JSON.stringify(a)),this.decode=null!=e&&e.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Ne(()=>we(this,void 0,void 0,function*(){this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this._endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r)))}disconnect(r,e){this.conn&&(this.conn.onclose=function(){},r?this.conn.close(r,null!=e?e:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}removeChannel(r){return we(this,void 0,void 0,function*(){const e=yield r.unsubscribe();return 0===this.channels.length&&this.disconnect(),e})}removeAllChannels(){return we(this,void 0,void 0,function*(){const r=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),r})}log(r,e,t){this.logger(r,e,t)}connectionState(){switch(this.conn&&this.conn.readyState){case ue.connecting:return G.Connecting;case ue.open:return G.Open;case ue.closing:return G.Closing;default:return G.Closed}}isConnected(){return this.connectionState()===G.Open}channel(r,e={config:{}}){this.isConnected()||this.connect();const t=new be(`realtime:${r}`,e,this);return this.channels.push(t),t}push(r){const{topic:e,event:t,payload:n,ref:s}=r;let o=()=>{this.encode(r,a=>{var c;null===(c=this.conn)||void 0===c||c.send(a)})};if(this.log("push",`${e} ${t} (${s})`,n),this.isConnected())if(["broadcast","presence","postgres_changes"].includes(t)){if(this._throttle(o)())return"rate limited"}else o();else this.sendBuffer.push(o)}setAuth(r){this.accessToken=r,this.channels.forEach(e=>{r&&e.updateJoinPayload({access_token:r}),e.joinedOnce&&e._isJoined()&&e._push(U.access_token,{access_token:r})})}_makeRef(){let r=this.ref+1;return this.ref=r===this.ref?0:r,this.ref.toString()}_leaveOpenTopic(r){let e=this.channels.find(t=>t.topic===r&&(t._isJoined()||t._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${r}"`),e.unsubscribe())}_remove(r){this.channels=this.channels.filter(e=>e._joinRef()!==r._joinRef())}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(r){this.decode(r.data,e=>{let{topic:t,event:n,payload:s,ref:o}=e;(o&&o===this.pendingHeartbeatRef||n===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${n} ${o&&"("+o+")"||""}`,s),this.channels.filter(a=>a._isMember(t)).forEach(a=>a._trigger(n,s,o)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(r=>r())}_onConnClose(r){this.log("transport","close",r),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(r))}_onConnError(r){this.log("transport",r.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(r))}_triggerChanError(){this.channels.forEach(r=>r._trigger(U.error))}_appendParams(r,e){if(0===Object.keys(e).length)return r;const t=r.match(/\?/)?"&":"?";return`${r}${t}${new URLSearchParams(e)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_sendHeartbeat(){var r;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(r=this.conn)||void 0===r||r.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}_throttle(r,e=this.eventsPerSecondLimitMs){return()=>!!this.inThrottle||(r(),e>0&&(this.inThrottle=!0,setTimeout(()=>{this.inThrottle=!1},e)),!1)}}class ke extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}}function T(i){return"object"==typeof i&&null!==i&&"__isStorageError"in i}class St extends ke{constructor(r,e){super(r),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class qe extends ke{constructor(r,e){super(r),this.name="StorageUnknownError",this.originalError=e}}const Je=i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(m.t.bind(m,9470,23)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)};var H=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})};const Se=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Tt=(i,r)=>H(void 0,void 0,void 0,function*(){const e=yield function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})}(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(m.t.bind(m,9470,23))).Response:Response});i instanceof e?i.json().then(t=>{r(new St(Se(t),i.status||500))}).catch(t=>{r(new qe(Se(t),t))}):r(new qe(Se(i),i))}),Et=(i,r,e,t)=>{const n={method:i,headers:(null==r?void 0:r.headers)||{}};return"GET"===i?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==r?void 0:r.headers),n.body=JSON.stringify(t),Object.assign(Object.assign({},n),e))};function he(i,r,e,t,n,s){return H(this,void 0,void 0,function*(){return new Promise((o,a)=>{i(e,Et(r,t,n,s)).then(c=>{if(!c.ok)throw c;return null!=t&&t.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Tt(c,a))})})}function Oe(i,r,e,t){return H(this,void 0,void 0,function*(){return he(i,"GET",r,e,t)})}function F(i,r,e,t,n){return H(this,void 0,void 0,function*(){return he(i,"POST",r,t,n,e)})}function jt(i,r,e,t,n){return H(this,void 0,void 0,function*(){return he(i,"PUT",r,t,n,e)})}function Ke(i,r,e,t,n){return H(this,void 0,void 0,function*(){return he(i,"DELETE",r,t,n,e)})}var R=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})};const $t={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ge={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Pt{constructor(r,e={},t,n){this.url=r,this.headers=e,this.bucketId=t,this.fetch=Je(n)}uploadOrUpdate(r,e,t,n){return R(this,void 0,void 0,function*(){try{let s;const o=Object.assign(Object.assign({},Ge),n),a=Object.assign(Object.assign({},this.headers),"POST"===r&&{"x-upsert":String(o.upsert)});typeof Blob<"u"&&t instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),s.append("",t)):typeof FormData<"u"&&t instanceof FormData?(s=t,s.append("cacheControl",o.cacheControl)):(s=t,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType);const c=this._removeEmptyFolders(e),u=this._getFinalPath(c),l=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:r,body:s,headers:a},null!=o&&o.duplex?{duplex:o.duplex}:{}));return l.ok?{data:{path:c},error:null}:{data:null,error:yield l.json()}}catch(s){if(T(s))return{data:null,error:s};throw s}})}upload(r,e,t){return R(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,e,t)})}uploadToSignedUrl(r,e,t,n){return R(this,void 0,void 0,function*(){const s=this._removeEmptyFolders(r),o=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let c;const u=Object.assign({upsert:Ge.upsert},n),l=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&t instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",t)):typeof FormData<"u"&&t instanceof FormData?(c=t,c.append("cacheControl",u.cacheControl)):(c=t,l["cache-control"]=`max-age=${u.cacheControl}`,l["content-type"]=u.contentType);const d=yield this.fetch(a.toString(),{method:"PUT",body:c,headers:l});return d.ok?{data:{path:s},error:null}:{data:null,error:yield d.json()}}catch(c){if(T(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(r){return R(this,void 0,void 0,function*(){try{let e=this._getFinalPath(r);const t=yield F(this.fetch,`${this.url}/object/upload/sign/${e}`,{},{headers:this.headers}),n=new URL(this.url+t.url),s=n.searchParams.get("token");if(!s)throw new ke("No token returned by API");return{data:{signedUrl:n.toString(),path:r,token:s},error:null}}catch(e){if(T(e))return{data:null,error:e};throw e}})}update(r,e,t){return R(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,e,t)})}move(r,e){return R(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e},{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}copy(r,e){return R(this,void 0,void 0,function*(){try{return{data:{path:(yield F(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:e},{headers:this.headers})).Key},error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}createSignedUrl(r,e,t){return R(this,void 0,void 0,function*(){try{let n=this._getFinalPath(r),s=yield F(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:e},null!=t&&t.transform?{transform:t.transform}:{}),{headers:this.headers});const o=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(n){if(T(n))return{data:null,error:n};throw n}})}createSignedUrls(r,e,t){return R(this,void 0,void 0,function*(){try{const n=yield F(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:r},{headers:this.headers}),s=null!=t&&t.download?`&download=${!0===t.download?"":t.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${s}`):null})),error:null}}catch(n){if(T(n))return{data:null,error:n};throw n}})}download(r,e){return R(this,void 0,void 0,function*(){const n=typeof(null==e?void 0:e.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==e?void 0:e.transform)||{}),o=s?`?${s}`:"";try{const a=this._getFinalPath(r);return{data:yield(yield Oe(this.fetch,`${this.url}/${n}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(T(a))return{data:null,error:a};throw a}})}getPublicUrl(r,e){const t=this._getFinalPath(r),n=[],s=null!=e&&e.download?`download=${!0===e.download?"":e.download}`:"";""!==s&&n.push(s);const a=typeof(null==e?void 0:e.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((null==e?void 0:e.transform)||{});""!==c&&n.push(c);let u=n.join("&");return""!==u&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${t}${u}`)}}}remove(r){return R(this,void 0,void 0,function*(){try{return{data:yield Ke(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(e){if(T(e))return{data:null,error:e};throw e}})}list(r,e,t){return R(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},$t),e),{prefix:r||""});return{data:yield F(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(T(n))return{data:null,error:n};throw n}})}_getFinalPath(r){return`${this.bucketId}/${r}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){const e=[];return r.width&&e.push(`width=${r.width}`),r.height&&e.push(`height=${r.height}`),r.resize&&e.push(`resize=${r.resize}`),r.format&&e.push(`format=${r.format}`),r.quality&&e.push(`quality=${r.quality}`),e.join("&")}}const At={"X-Client-Info":"storage-js/2.5.4"};var W=function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})};class Rt{constructor(r,e={},t){this.url=r,this.headers=Object.assign(Object.assign({},At),e),this.fetch=Je(t)}listBuckets(){return W(this,void 0,void 0,function*(){try{return{data:yield Oe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(T(r))return{data:null,error:r};throw r}})}getBucket(r){return W(this,void 0,void 0,function*(){try{return{data:yield Oe(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(e){if(T(e))return{data:null,error:e};throw e}})}createBucket(r,e={public:!1}){return W(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/bucket`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}updateBucket(r,e){return W(this,void 0,void 0,function*(){try{return{data:yield jt(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}})}emptyBucket(r){return W(this,void 0,void 0,function*(){try{return{data:yield F(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(T(e))return{data:null,error:e};throw e}})}deleteBucket(r){return W(this,void 0,void 0,function*(){try{return{data:yield Ke(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(e){if(T(e))return{data:null,error:e};throw e}})}}class Ct extends Rt{constructor(r,e={},t){super(r,e,t)}from(r){return new Pt(this.url,this.headers,r,this.fetch)}}let se="";se=typeof Deno<"u"?"deno":typeof document<"u"?"web":typeof navigator<"u"&&"ReactNative"===navigator.product?"react-native":"node";const Lt={"X-Client-Info":`supabase-js-${se}/2.36.0`};const Ft=(i,r,e)=>{const t=(i=>{let r;return r=i||(typeof fetch>"u"?te():fetch),(...e)=>r(...e)})(e),n=typeof Headers>"u"?D.Headers:Headers;return(s,o)=>function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})}(void 0,void 0,void 0,function*(){var a;const c=null!==(a=yield r())&&void 0!==a?a:i;let u=new n(null==o?void 0:o.headers);return u.has("apikey")||u.set("apikey",i),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),t(s,Object.assign(Object.assign({},o),{headers:u}))})},Z=()=>typeof document<"u",q={tested:!1,writable:!1},ie=()=>{if(!Z())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch{return!1}if(q.tested)return q.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),q.tested=!0,q.writable=!0}catch{q.tested=!0,q.writable=!1}return q.writable};function xe(i){const r={},e=new URL(i);if(e.hash&&"#"===e.hash[0])try{new URLSearchParams(e.hash.substring(1)).forEach((n,s)=>{r[s]=n})}catch{}return e.searchParams.forEach((t,n)=>{r[n]=t}),r}const He=i=>{let r;return r=i||(typeof fetch>"u"?(...e)=>Promise.resolve().then(m.t.bind(m,9470,23)).then(({default:t})=>t(...e)):fetch),(...e)=>r(...e)},qt=i=>"object"==typeof i&&null!==i&&"status"in i&&"ok"in i&&"json"in i&&"function"==typeof i.json,V=function(){var i=(0,h.Z)(function*(r,e,t){yield r.setItem(e,JSON.stringify(t))});return function(e,t,n){return i.apply(this,arguments)}}(),de=function(){var i=(0,h.Z)(function*(r,e){const t=yield r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}});return function(e,t){return i.apply(this,arguments)}}(),Te=function(){var i=(0,h.Z)(function*(r,e){yield r.removeItem(e)});return function(e,t){return i.apply(this,arguments)}}();class fe{constructor(){this.promise=new fe.promiseConstructor((r,e)=>{this.resolve=r,this.reject=e})}}function We(i){const e=i.split(".");if(3!==e.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");return JSON.parse(function Jt(i){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t,n,s,o,a,c,u,e="",l=0;for(i=i.replace("-","+").replace("_","/");l<i.length;)o=r.indexOf(i.charAt(l++)),a=r.indexOf(i.charAt(l++)),c=r.indexOf(i.charAt(l++)),u=r.indexOf(i.charAt(l++)),t=o<<2|a>>4,n=(15&a)<<4|c>>2,s=(3&c)<<6|u,e+=String.fromCharCode(t),64!=c&&0!=n&&(e+=String.fromCharCode(n)),64!=u&&0!=s&&(e+=String.fromCharCode(s));return e}(e[1]))}function Ee(){return(Ee=(0,h.Z)(function*(i){return yield new Promise(r=>{setTimeout(()=>r(null),i)})})).apply(this,arguments)}function Ht(i){return("0"+i.toString(16)).substr(-2)}function oe(){const r=new Uint32Array(56);if(typeof crypto>"u"){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let n="";for(let s=0;s<56;s++)n+=e.charAt(Math.floor(Math.random()*t));return n}return crypto.getRandomValues(r),Array.from(r,Ht).join("")}function je(){return(je=(0,h.Z)(function*(i){const e=(new TextEncoder).encode(i),t=yield crypto.subtle.digest("SHA-256",e),n=new Uint8Array(t);return Array.from(n).map(s=>String.fromCharCode(s)).join("")})).apply(this,arguments)}function ae(i){return $e.apply(this,arguments)}function $e(){return $e=(0,h.Z)(function*(i){if(typeof crypto>"u")return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const r=yield function Wt(i){return je.apply(this,arguments)}(i);return function Vt(i){return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}(r)}),$e.apply(this,arguments)}fe.promiseConstructor=Promise;class Pe extends Error{constructor(r,e){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=e}}function v(i){return"object"==typeof i&&null!==i&&"__isAuthError"in i}class Qt extends Pe{constructor(r,e){super(r,e),this.name="AuthApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ve extends Pe{constructor(r,e){super(r),this.name="AuthUnknownError",this.originalError=e}}class Q extends Pe{constructor(r,e,t){super(r),this.name=e,this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class X extends Q{constructor(){super("Auth session missing!","AuthSessionMissingError",400)}}class Ae extends Q{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500)}}class _e extends Q{constructor(r){super(r,"AuthInvalidCredentialsError",400)}}class ge extends Q{constructor(r,e=null){super(r,"AuthImplicitGrantRedirectError",500),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Qe extends Q{constructor(r,e=null){super(r,"AuthPKCEGrantCodeExchangeError",500),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Re extends Q{constructor(r,e){super(r,"AuthRetryableFetchError",e)}}function Xe(i){return v(i)&&"AuthRetryableFetchError"===i.name}const le=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),er=[502,503,504];function Ye(i){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,h.Z)(function*(i){if(!qt(i))throw new Re(le(i),0);if(er.includes(i.status))throw new Re(le(i),i.status);let r;try{r=yield i.json()}catch(e){throw new Ve(le(e),e)}throw new Qt(le(r),i.status||500)})).apply(this,arguments)}const tr=(i,r,e,t)=>{const n={method:i,headers:(null==r?void 0:r.headers)||{}};return"GET"===i?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==r?void 0:r.headers),n.body=JSON.stringify(t),Object.assign(Object.assign({},n),e))};function y(i,r,e,t){return Ie.apply(this,arguments)}function Ie(){return Ie=(0,h.Z)(function*(i,r,e,t){var n;const s=Object.assign({},null==t?void 0:t.headers);null!=t&&t.jwt&&(s.Authorization=`Bearer ${t.jwt}`);const o=null!==(n=null==t?void 0:t.query)&&void 0!==n?n:{};null!=t&&t.redirectTo&&(o.redirect_to=t.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=yield function rr(i,r,e,t,n,s){return Le.apply(this,arguments)}(i,r,e+a,{headers:s,noResolveJson:null==t?void 0:t.noResolveJson},{},null==t?void 0:t.body);return null!=t&&t.xform?null==t?void 0:t.xform(c):{data:Object.assign({},c),error:null}}),Ie.apply(this,arguments)}function Le(){return(Le=(0,h.Z)(function*(i,r,e,t,n,s){const o=tr(r,t,n,s);let a;try{a=yield i(e,o)}catch(c){throw console.error(c),new Re(le(c),0)}if(a.ok||(yield Ye(a)),null!=t&&t.noResolveJson)return a;try{return yield a.json()}catch(c){yield Ye(c)}})).apply(this,arguments)}function N(i){var r;let e=null;return function or(i){return i.access_token&&i.refresh_token&&i.expires_in}(i)&&(e=Object.assign({},i),i.expires_at||(e.expires_at=function zt(i){return Math.round(Date.now()/1e3)+i}(i.expires_in))),{data:{session:e,user:null!==(r=i.user)&&void 0!==r?r:i},error:null}}function M(i){var r;return{data:{user:null!==(r=i.user)&&void 0!==r?r:i},error:null}}function nr(i){return{data:i,error:null}}function sr(i){const{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:s}=i,o=function(i,r){var e={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&r.indexOf(t)<0&&(e[t]=i[t]);if(null!=i&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(i);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(i,t[n])&&(e[t[n]]=i[t[n]])}return e}(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:r,email_otp:e,hashed_token:t,redirect_to:n,verification_type:s},user:Object.assign({},o)},error:null}}function ir(i){return i}class lr{constructor({url:r="",headers:e={},fetch:t}){this.url=r,this.headers=e,this.fetch=He(t),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(r,e="global"){var t=this;return(0,h.Z)(function*(){try{return yield y(t.fetch,"POST",`${t.url}/logout?scope=${e}`,{headers:t.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(n){if(v(n))return{data:null,error:n};throw n}})()}inviteUserByEmail(r,e={}){var t=this;return(0,h.Z)(function*(){try{return yield y(t.fetch,"POST",`${t.url}/invite`,{body:{email:r,data:e.data},headers:t.headers,redirectTo:e.redirectTo,xform:M})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}generateLink(r){var e=this;return(0,h.Z)(function*(){try{const{options:t}=r,n=function(i,r){var e={};for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&r.indexOf(t)<0&&(e[t]=i[t]);if(null!=i&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(t=Object.getOwnPropertySymbols(i);n<t.length;n++)r.indexOf(t[n])<0&&Object.prototype.propertyIsEnumerable.call(i,t[n])&&(e[t[n]]=i[t[n]])}return e}(r,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=null==n?void 0:n.newEmail,delete s.newEmail),yield y(e.fetch,"POST",`${e.url}/admin/generate_link`,{body:s,headers:e.headers,xform:sr,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(v(t))return{data:{properties:null,user:null},error:t};throw t}})()}createUser(r){var e=this;return(0,h.Z)(function*(){try{return yield y(e.fetch,"POST",`${e.url}/admin/users`,{body:r,headers:e.headers,xform:M})}catch(t){if(v(t))return{data:{user:null},error:t};throw t}})()}listUsers(r){var e=this;return(0,h.Z)(function*(){var t,n,s,o,a,c,u;try{const l={nextPage:null,lastPage:0,total:0},d=yield y(e.fetch,"GET",`${e.url}/admin/users`,{headers:e.headers,noResolveJson:!0,query:{page:null!==(n=null===(t=null==r?void 0:r.page)||void 0===t?void 0:t.toString())&&void 0!==n?n:"",per_page:null!==(o=null===(s=null==r?void 0:r.perPage)||void 0===s?void 0:s.toString())&&void 0!==o?o:""},xform:ir});if(d.error)throw d.error;const _=yield d.json(),g=null!==(a=d.headers.get("x-total-count"))&&void 0!==a?a:0,f=null!==(u=null===(c=d.headers.get("link"))||void 0===c?void 0:c.split(","))&&void 0!==u?u:[];return f.length>0&&(f.forEach(p=>{const b=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),O=JSON.parse(p.split(";")[1].split("=")[1]);l[`${O}Page`]=b}),l.total=parseInt(g)),{data:Object.assign(Object.assign({},_),l),error:null}}catch(l){if(v(l))return{data:{users:[]},error:l};throw l}})()}getUserById(r){var e=this;return(0,h.Z)(function*(){try{return yield y(e.fetch,"GET",`${e.url}/admin/users/${r}`,{headers:e.headers,xform:M})}catch(t){if(v(t))return{data:{user:null},error:t};throw t}})()}updateUserById(r,e){var t=this;return(0,h.Z)(function*(){try{return yield y(t.fetch,"PUT",`${t.url}/admin/users/${r}`,{body:e,headers:t.headers,xform:M})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}deleteUser(r,e=!1){var t=this;return(0,h.Z)(function*(){try{return yield y(t.fetch,"DELETE",`${t.url}/admin/users/${r}`,{headers:t.headers,body:{should_soft_delete:e},xform:M})}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}_listFactors(r){var e=this;return(0,h.Z)(function*(){try{const{data:t,error:n}=yield y(e.fetch,"GET",`${e.url}/admin/users/${r.userId}/factors`,{headers:e.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(v(t))return{data:null,error:t};throw t}})()}_deleteFactor(r){var e=this;return(0,h.Z)(function*(){try{return{data:yield y(e.fetch,"DELETE",`${e.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:e.headers}),error:null}}catch(t){if(v(t))return{data:null,error:t};throw t}})()}}const dr={getItem:i=>ie()?globalThis.localStorage.getItem(i):null,setItem:(i,r)=>{ie()&&globalThis.localStorage.setItem(i,r)},removeItem:i=>{ie()&&globalThis.localStorage.removeItem(i)}};function rt(i={}){return{getItem:r=>i[r]||null,setItem:(r,e)=>{i[r]=e},removeItem:r=>{delete i[r]}}}globalThis&&ie()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug");class _r extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}!function fr(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}();const pr={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:{"X-Client-Info":"gotrue-js/2.54.0"},flowType:"implicit",debug:!1},ce=3e4;function vr(i,r,e){return De.apply(this,arguments)}function De(){return(De=(0,h.Z)(function*(i,r,e){return yield e()})).apply(this,arguments)}let yr=(()=>{class i{constructor(e){var n,t=this;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=i.nextInstanceID,i.nextInstanceID+=1,this.instanceID>0&&Z()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},pr),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new lr({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=He(s.fetch),this.lock=s.lock||vr,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:ie()?this.storage=dr:(this.memoryStorage={},this.storage=rt(this.memoryStorage)):(this.memoryStorage={},this.storage=rt(this.memoryStorage)),Z()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}null===(n=this.broadcastChannel)||void 0===n||n.addEventListener("message",function(){var o=(0,h.Z)(function*(a){t._debug("received broadcast notification from other tab or client",a),yield t._notifyAllSubscribers(a.data.event,a.data.session,!1)});return function(a){return o.apply(this,arguments)}}())}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (2.54.0) ${(new Date).toISOString()}`,...e),this}initialize(){var e=this;return(0,h.Z)(function*(){return e.initializePromise||(e.initializePromise=(0,h.Z)(function*(){return yield e._acquireLock(-1,(0,h.Z)(function*(){return yield e._initialize()}))})()),yield e.initializePromise})()}_initialize(){var e=this;return(0,h.Z)(function*(){try{const t=!!Z()&&(yield e._isPKCEFlow());if(e._debug("#_initialize()","begin","is PKCE flow",t),t||e.detectSessionInUrl&&e._isImplicitGrantFlow()){const{data:n,error:s}=yield e._getSessionFromURL(t);if(s)return e._debug("#_initialize()","error detecting session from URL",s),yield e._removeSession(),{error:s};const{session:o,redirectType:a}=n;return e._debug("#_initialize()","detected session in URL",o,"redirect type",a),yield e._saveSession(o),setTimeout((0,h.Z)(function*(){"recovery"===a?yield e._notifyAllSubscribers("PASSWORD_RECOVERY",o):yield e._notifyAllSubscribers("SIGNED_IN",o)}),0),{error:null}}return yield e._recoverAndRefresh(),{error:null}}catch(t){return v(t)?{error:t}:{error:new Ve("Unexpected error during initialization",t)}}finally{yield e._handleVisibilityChange(),e._debug("#_initialize()","end")}})()}signUp(e){var t=this;return(0,h.Z)(function*(){var n,s,o;try{let a;if(yield t._removeSession(),"email"in e){const{email:_,password:g,options:f}=e;let p=null,b=null;if("pkce"===t.flowType){const O=oe();yield V(t.storage,`${t.storageKey}-code-verifier`,O),p=yield ae(O),b=O===p?"plain":"s256"}a=yield y(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,redirectTo:null==f?void 0:f.emailRedirectTo,body:{email:_,password:g,data:null!==(n=null==f?void 0:f.data)&&void 0!==n?n:{},gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken},code_challenge:p,code_challenge_method:b},xform:N})}else{if(!("phone"in e))throw new _e("You must provide either an email or phone number and a password");{const{phone:_,password:g,options:f}=e;a=yield y(t.fetch,"POST",`${t.url}/signup`,{headers:t.headers,body:{phone:_,password:g,data:null!==(s=null==f?void 0:f.data)&&void 0!==s?s:{},channel:null!==(o=null==f?void 0:f.channel)&&void 0!==o?o:"sms",gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken}},xform:N})}}const{data:c,error:u}=a;if(u||!c)return{data:{user:null,session:null},error:u};const l=c.session,d=c.user;return c.session&&(yield t._saveSession(c.session),yield t._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:d,session:l},error:null}}catch(a){if(v(a))return{data:{user:null,session:null},error:a};throw a}})()}signInWithPassword(e){var t=this;return(0,h.Z)(function*(){try{let n;if(yield t._removeSession(),"email"in e){const{email:a,password:c,options:u}=e;n=yield y(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{email:a,password:c,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken}},xform:N})}else{if(!("phone"in e))throw new _e("You must provide either an email or phone number and a password");{const{phone:a,password:c,options:u}=e;n=yield y(t.fetch,"POST",`${t.url}/token?grant_type=password`,{headers:t.headers,body:{phone:a,password:c,gotrue_meta_security:{captcha_token:null==u?void 0:u.captchaToken}},xform:N})}}const{data:s,error:o}=n;return o?{data:{user:null,session:null},error:o}:s&&s.session&&s.user?(s.session&&(yield t._saveSession(s.session),yield t._notifyAllSubscribers("SIGNED_IN",s.session)),{data:{user:s.user,session:s.session},error:o}):{data:{user:null,session:null},error:new Ae}}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOAuth(e){var t=this;return(0,h.Z)(function*(){var n,s,o,a;return yield t._removeSession(),yield t._handleProviderSignIn(e.provider,{redirectTo:null===(n=e.options)||void 0===n?void 0:n.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(o=e.options)||void 0===o?void 0:o.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})})()}exchangeCodeForSession(e){var t=this;return(0,h.Z)(function*(){return yield t.initializePromise,t._acquireLock(-1,(0,h.Z)(function*(){return t._exchangeCodeForSession(e)}))})()}_exchangeCodeForSession(e){var t=this;return(0,h.Z)(function*(){const n=yield de(t.storage,`${t.storageKey}-code-verifier`),{data:s,error:o}=yield y(t.fetch,"POST",`${t.url}/token?grant_type=pkce`,{headers:t.headers,body:{auth_code:e,code_verifier:n},xform:N});return yield Te(t.storage,`${t.storageKey}-code-verifier`),o?{data:{user:null,session:null},error:o}:s&&s.session&&s.user?(s.session&&(yield t._saveSession(s.session),yield t._notifyAllSubscribers("SIGNED_IN",s.session)),{data:s,error:o}):{data:{user:null,session:null},error:new Ae}})()}signInWithIdToken(e){var t=this;return(0,h.Z)(function*(){yield t._removeSession();try{const{options:n,provider:s,token:o,access_token:a,nonce:c}=e,u=yield y(t.fetch,"POST",`${t.url}/token?grant_type=id_token`,{headers:t.headers,body:{provider:s,id_token:o,access_token:a,nonce:c,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:N}),{data:l,error:d}=u;return d?{data:{user:null,session:null},error:d}:l&&l.session&&l.user?(l.session&&(yield t._saveSession(l.session),yield t._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:d}):{data:{user:null,session:null},error:new Ae}}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}signInWithOtp(e){var t=this;return(0,h.Z)(function*(){var n,s,o,a,c;try{if(yield t._removeSession(),"email"in e){const{email:u,options:l}=e;let d=null,_=null;if("pkce"===t.flowType){const f=oe();yield V(t.storage,`${t.storageKey}-code-verifier`,f),d=yield ae(f),_=f===d?"plain":"s256"}const{error:g}=yield y(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{email:u,data:null!==(n=null==l?void 0:l.data)&&void 0!==n?n:{},create_user:null===(s=null==l?void 0:l.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==l?void 0:l.captchaToken},code_challenge:d,code_challenge_method:_},redirectTo:null==l?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:g}}if("phone"in e){const{phone:u,options:l}=e,{data:d,error:_}=yield y(t.fetch,"POST",`${t.url}/otp`,{headers:t.headers,body:{phone:u,data:null!==(o=null==l?void 0:l.data)&&void 0!==o?o:{},create_user:null===(a=null==l?void 0:l.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==l?void 0:l.captchaToken},channel:null!==(c=null==l?void 0:l.channel)&&void 0!==c?c:"sms"}});return{data:{user:null,session:null,messageId:null==d?void 0:d.message_id},error:_}}throw new _e("You must provide either an email or phone number.")}catch(u){if(v(u))return{data:{user:null,session:null},error:u};throw u}})()}verifyOtp(e){var t=this;return(0,h.Z)(function*(){var n,s;try{let o,a;"email_change"!==e.type&&"phone_change"!==e.type&&(yield t._removeSession()),"options"in e&&(o=null===(n=e.options)||void 0===n?void 0:n.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:c,error:u}=yield y(t.fetch,"POST",`${t.url}/verify`,{headers:t.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:o,xform:N});if(u)throw u;if(!c)throw new Error("An error occurred on token verification.");const l=c.session,d=c.user;return null!=l&&l.access_token&&(yield t._saveSession(l),yield t._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:d,session:l},error:null}}catch(o){if(v(o))return{data:{user:null,session:null},error:o};throw o}})()}signInWithSSO(e){var t=this;return(0,h.Z)(function*(){var n,s,o;try{return yield t._removeSession(),yield y(t.fetch,"POST",`${t.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(n=e.options)||void 0===n?void 0:n.redirectTo)&&void 0!==s?s:void 0}),null!==(o=null==e?void 0:e.options)&&void 0!==o&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0}),headers:t.headers,xform:nr})}catch(a){if(v(a))return{data:null,error:a};throw a}})()}reauthenticate(){var e=this;return(0,h.Z)(function*(){return yield e.initializePromise,yield e._acquireLock(-1,(0,h.Z)(function*(){return yield e._reauthenticate()}))})()}_reauthenticate(){var e=this;return(0,h.Z)(function*(){try{return yield e._useSession(function(){var t=(0,h.Z)(function*(n){const{data:{session:s},error:o}=n;if(o)throw o;if(!s)throw new X;const{error:a}=yield y(e.fetch,"GET",`${e.url}/reauthenticate`,{headers:e.headers,jwt:s.access_token});return{data:{user:null,session:null},error:a}});return function(n){return t.apply(this,arguments)}}())}catch(t){if(v(t))return{data:{user:null,session:null},error:t};throw t}})()}resend(e){var t=this;return(0,h.Z)(function*(){try{"email_change"!=e.type&&"phone_change"!=e.type&&(yield t._removeSession());const n=`${t.url}/resend`;if("email"in e){const{email:s,type:o,options:a}=e,{error:c}=yield y(t.fetch,"POST",n,{headers:t.headers,body:{email:s,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:c}}if("phone"in e){const{phone:s,type:o,options:a}=e,{data:c,error:u}=yield y(t.fetch,"POST",n,{headers:t.headers,body:{phone:s,type:o,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==c?void 0:c.message_id},error:u}}throw new _e("You must provide either an email or phone number and a type")}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}getSession(){var e=this;return(0,h.Z)(function*(){return yield e.initializePromise,e._acquireLock(-1,(0,h.Z)(function*(){return e._useSession(function(){var t=(0,h.Z)(function*(n){return n});return function(n){return t.apply(this,arguments)}}())}))})()}_acquireLock(e,t){var n=this;return(0,h.Z)(function*(){n._debug("#_acquireLock","begin",e);try{if(n.lockAcquired){const s=n.pendingInLock.length?n.pendingInLock[n.pendingInLock.length-1]:Promise.resolve(),o=(0,h.Z)(function*(){return yield s,yield t()})();return n.pendingInLock.push((0,h.Z)(function*(){try{yield o}catch{}})()),o}return yield n.lock(`lock:${n.storageKey}`,e,(0,h.Z)(function*(){n._debug("#_acquireLock","lock acquired for storage key",n.storageKey);try{n.lockAcquired=!0;const s=t();for(n.pendingInLock.push((0,h.Z)(function*(){try{yield s}catch{}})()),yield s;n.pendingInLock.length;){const o=[...n.pendingInLock];yield Promise.all(o),n.pendingInLock.splice(0,o.length)}return yield s}finally{n._debug("#_acquireLock","lock released for storage key",n.storageKey),n.lockAcquired=!1}}))}finally{n._debug("#_acquireLock","end")}})()}_useSession(e){var t=this;return(0,h.Z)(function*(){t._debug("#_useSession","begin");try{const n=yield t.__loadSession();return yield e(n)}finally{t._debug("#_useSession","end")}})()}__loadSession(){var e=this;return(0,h.Z)(function*(){e._debug("#__loadSession()","begin"),e.lockAcquired||e._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let t=null;const n=yield de(e.storage,e.storageKey);if(e._debug("#getSession()","session from storage",n),null!==n&&(e._isValidSession(n)?t=n:(e._debug("#getSession()","session from storage is not valid"),yield e._removeSession())),!t)return{data:{session:null},error:null};const s=!!t.expires_at&&t.expires_at<=Date.now()/1e3;if(e._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",t.expires_at),!s)return{data:{session:t},error:null};const{session:o,error:a}=yield e._callRefreshToken(t.refresh_token);return a?{data:{session:null},error:a}:{data:{session:o},error:null}}finally{e._debug("#__loadSession()","end")}})()}getUser(e){var t=this;return(0,h.Z)(function*(){return e?yield t._getUser(e):(yield t.initializePromise,t._acquireLock(-1,(0,h.Z)(function*(){return yield t._getUser()})))})()}_getUser(e){var t=this;return(0,h.Z)(function*(){try{return e?yield y(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:e,xform:M}):yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o,a;const{data:c,error:u}=s;if(u)throw u;return yield y(t.fetch,"GET",`${t.url}/user`,{headers:t.headers,jwt:null!==(a=null===(o=c.session)||void 0===o?void 0:o.access_token)&&void 0!==a?a:void 0,xform:M})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:{user:null},error:n};throw n}})()}updateUser(e,t={}){var n=this;return(0,h.Z)(function*(){return yield n.initializePromise,yield n._acquireLock(-1,(0,h.Z)(function*(){return yield n._updateUser(e,t)}))})()}_updateUser(e,t={}){var n=this;return(0,h.Z)(function*(){try{return yield n._useSession(function(){var s=(0,h.Z)(function*(o){const{data:a,error:c}=o;if(c)throw c;if(!a.session)throw new X;const u=a.session;let l=null,d=null;if("pkce"===n.flowType&&null!=e.email){const f=oe();yield V(n.storage,`${n.storageKey}-code-verifier`,f),l=yield ae(f),d=f===l?"plain":"s256"}const{data:_,error:g}=yield y(n.fetch,"PUT",`${n.url}/user`,{headers:n.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:d}),jwt:u.access_token,xform:M});if(g)throw g;return u.user=_.user,yield n._saveSession(u),yield n._notifyAllSubscribers("USER_UPDATED",u),{data:{user:u.user},error:null}});return function(o){return s.apply(this,arguments)}}())}catch(s){if(v(s))return{data:{user:null},error:s};throw s}})()}_decodeJWT(e){return We(e)}setSession(e){var t=this;return(0,h.Z)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){return yield t._setSession(e)}))})()}_setSession(e){var t=this;return(0,h.Z)(function*(){try{if(!e.access_token||!e.refresh_token)throw new X;const n=Date.now()/1e3;let s=n,o=!0,a=null;const c=We(e.access_token);if(c.exp&&(s=c.exp,o=s<=n),o){const{session:u,error:l}=yield t._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!u)return{data:{user:null,session:null},error:null};a=u}else{const{data:u,error:l}=yield t._getUser(e.access_token);if(l)throw l;a={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:s-n,expires_at:s},yield t._saveSession(a),yield t._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(n){if(v(n))return{data:{session:null,user:null},error:n};throw n}})()}refreshSession(e){var t=this;return(0,h.Z)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){return yield t._refreshSession(e)}))})()}_refreshSession(e){var t=this;return(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;if(!e){const{data:u,error:l}=s;if(l)throw l;e=null!==(o=u.session)&&void 0!==o?o:void 0}if(null==e||!e.refresh_token)throw new X;const{session:a,error:c}=yield t._callRefreshToken(e.refresh_token);return c?{data:{user:null,session:null},error:c}:a?{data:{user:a.user,session:a},error:null}:{data:{user:null,session:null},error:null}});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:{user:null,session:null},error:n};throw n}})()}_getSessionFromURL(e){var t=this;return(0,h.Z)(function*(){try{if(!Z())throw new ge("No browser detected.");if("implicit"===t.flowType&&!t._isImplicitGrantFlow())throw new ge("Not a valid implicit grant flow url.");if("pkce"==t.flowType&&!e)throw new Qe("Not a valid PKCE flow url.");const n=xe(window.location.href);if(e){if(!n.code)throw new Qe("No code detected.");const{data:j,error:J}=yield t._exchangeCodeForSession(n.code);if(J)throw J;const st=new URL(window.location.href);return st.searchParams.delete("code"),window.history.replaceState(window.history.state,"",st.toString()),{data:{session:j.session,redirectType:null},error:null}}if(n.error||n.error_description||n.error_code)throw new ge(n.error_description||"Error in URL with unspecified error_description",{error:n.error||"unspecified_error",code:n.error_code||"unspecified_code"});const{provider_token:s,provider_refresh_token:o,access_token:a,refresh_token:c,expires_in:u,expires_at:l,token_type:d}=n;if(!(a&&u&&c&&d))throw new ge("No session defined in URL");const _=Math.round(Date.now()/1e3),g=parseInt(u);let f=_+g;l&&(f=parseInt(l));const p=f-_;1e3*p<=ce&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${g}s`);const b=f-g;_-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,f,_):_-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clok for skew",b,f,_);const{data:O,error:E}=yield t._getUser(a);if(E)throw E;const P={provider_token:s,provider_refresh_token:o,access_token:a,expires_in:g,expires_at:f,refresh_token:c,token_type:d,user:O.user};return window.location.hash="",t._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:P,redirectType:n.type},error:null}}catch(n){if(v(n))return{data:{session:null,redirectType:null},error:n};throw n}})()}_isImplicitGrantFlow(){const e=xe(window.location.href);return!(!Z()||!e.access_token&&!e.error_description)}_isPKCEFlow(){var e=this;return(0,h.Z)(function*(){const t=xe(window.location.href),n=yield de(e.storage,`${e.storageKey}-code-verifier`);return!(!t.code||!n)})()}signOut(e={scope:"global"}){var t=this;return(0,h.Z)(function*(){return yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){return yield t._signOut(e)}))})()}_signOut({scope:e}={scope:"global"}){var t=this;return(0,h.Z)(function*(){return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;const{data:a,error:c}=s;if(c)return{error:c};const u=null===(o=a.session)||void 0===o?void 0:o.access_token;if(u){const{error:l}=yield t.admin.signOut(u,e);if(l&&(!function Xt(i){return v(i)&&"AuthApiError"===i.name}(l)||404!==l.status&&401!==l.status))return{error:l}}return"others"!==e&&(yield t._removeSession(),yield Te(t.storage,`${t.storageKey}-code-verifier`),yield t._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}});return function(s){return n.apply(this,arguments)}}())})()}onAuthStateChange(e){var t=this;const n=function Bt(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const r=16*Math.random()|0;return("x"==i?r:3&r|8).toString(16)})}(),s={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,s),(0,h.Z)(function*(){yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){t._emitInitialSession(n)}))})(),{data:{subscription:s}}}_emitInitialSession(e){var t=this;return(0,h.Z)(function*(){return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o,a;try{const{data:{session:c},error:u}=s;if(u)throw u;yield null===(o=t.stateChangeEmitters.get(e))||void 0===o?void 0:o.callback("INITIAL_SESSION",c),t._debug("INITIAL_SESSION","callback id",e,"session",c)}catch(c){yield null===(a=t.stateChangeEmitters.get(e))||void 0===a?void 0:a.callback("INITIAL_SESSION",null),t._debug("INITIAL_SESSION","callback id",e,"error",c),console.error(c)}});return function(s){return n.apply(this,arguments)}}())})()}resetPasswordForEmail(e,t={}){var n=this;return(0,h.Z)(function*(){let s=null,o=null;if("pkce"===n.flowType){const a=oe();yield V(n.storage,`${n.storageKey}-code-verifier`,a),s=yield ae(a),o=a===s?"plain":"s256"}try{return yield y(n.fetch,"POST",`${n.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:o,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:n.headers,redirectTo:t.redirectTo})}catch(a){if(v(a))return{data:null,error:a};throw a}})()}_refreshAccessToken(e){var t=this;return(0,h.Z)(function*(){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;t._debug(n,"begin");try{const s=Date.now();return yield function Gt(i,r){return new Promise((t,n)=>{(0,h.Z)(function*(){for(let s=0;s<1/0;s++)try{const o=yield i(s);if(!r(s,null,o))return void t(o)}catch(o){if(!r(s,o))return void n(o)}})()})}(function(){var o=(0,h.Z)(function*(a){return yield function Kt(i){return Ee.apply(this,arguments)}(200*a),t._debug(n,"refreshing attempt",a),yield y(t.fetch,"POST",`${t.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:t.headers,xform:N})});return function(a){return o.apply(this,arguments)}}(),(o,a,c)=>c&&c.error&&Xe(c.error)&&Date.now()+200*(o+1)-s<ce)}catch(s){if(t._debug(n,"error",s),v(s))return{data:{session:null,user:null},error:s};throw s}finally{t._debug(n,"end")}})()}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){var n=this;return(0,h.Z)(function*(){const s=yield n._getUrlForProvider(e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return n._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Z()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})()}_recoverAndRefresh(){var e=this;return(0,h.Z)(function*(){var t;const n="#_recoverAndRefresh()";e._debug(n,"begin");try{const s=yield de(e.storage,e.storageKey);if(e._debug(n,"session from storage",s),!e._isValidSession(s))return e._debug(n,"session is not valid"),void(null!==s&&(yield e._removeSession()));const o=Math.round(Date.now()/1e3),a=(null!==(t=s.expires_at)&&void 0!==t?t:1/0)<o+10;if(e._debug(n,`session has${a?"":" not"} expired with margin of 10s`),a){if(e.autoRefreshToken&&s.refresh_token){const{error:c}=yield e._callRefreshToken(s.refresh_token);c&&(console.error(c),Xe(c)||(e._debug(n,"refresh failed with a non-retryable error, removing the session",c),yield e._removeSession()))}}else yield e._notifyAllSubscribers("SIGNED_IN",s)}catch(s){return e._debug(n,"error",s),void console.error(s)}finally{e._debug(n,"end")}})()}_callRefreshToken(e){var t=this;return(0,h.Z)(function*(){var n,s;if(!e)throw new X;if(t.refreshingDeferred)return t.refreshingDeferred.promise;const o=`#_callRefreshToken(${e.substring(0,5)}...)`;t._debug(o,"begin");try{t.refreshingDeferred=new fe;const{data:a,error:c}=yield t._refreshAccessToken(e);if(c)throw c;if(!a.session)throw new X;yield t._saveSession(a.session),yield t._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const u={session:a.session,error:null};return t.refreshingDeferred.resolve(u),u}catch(a){if(t._debug(o,"error",a),v(a)){const c={session:null,error:a};return null===(n=t.refreshingDeferred)||void 0===n||n.resolve(c),c}throw null===(s=t.refreshingDeferred)||void 0===s||s.reject(a),a}finally{t.refreshingDeferred=null,t._debug(o,"end")}})()}_notifyAllSubscribers(e,t,n=!0){var s=this;return(0,h.Z)(function*(){const o=`#_notifyAllSubscribers(${e})`;s._debug(o,"begin",t,`broadcast = ${n}`);try{s.broadcastChannel&&n&&s.broadcastChannel.postMessage({event:e,session:t});const a=[],c=Array.from(s.stateChangeEmitters.values()).map(function(){var u=(0,h.Z)(function*(l){try{yield l.callback(e,t)}catch(d){a.push(d)}});return function(l){return u.apply(this,arguments)}}());if(yield Promise.all(c),a.length>0){for(let u=0;u<a.length;u+=1)console.error(a[u]);throw a[0]}}finally{s._debug(o,"end")}})()}_saveSession(e){var t=this;return(0,h.Z)(function*(){t._debug("#_saveSession()",e),yield t._persistSession(e)})()}_persistSession(e){return this._debug("#_persistSession()",e),V(this.storage,this.storageKey,e)}_removeSession(){var e=this;return(0,h.Z)(function*(){e._debug("#_removeSession()"),yield Te(e.storage,e.storageKey)})()}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Z()&&null!=window&&window.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){var e=this;return(0,h.Z)(function*(){yield e._stopAutoRefresh(),e._debug("#_startAutoRefresh()");const t=setInterval(()=>e._autoRefreshTokenTick(),ce);e.autoRefreshTicker=t,t&&"object"==typeof t&&"function"==typeof t.unref?t.unref():typeof Deno<"u"&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(t),setTimeout((0,h.Z)(function*(){yield e.initializePromise,yield e._autoRefreshTokenTick()}),0)})()}_stopAutoRefresh(){var e=this;return(0,h.Z)(function*(){e._debug("#_stopAutoRefresh()");const t=e.autoRefreshTicker;e.autoRefreshTicker=null,t&&clearInterval(t)})()}startAutoRefresh(){var e=this;return(0,h.Z)(function*(){e._removeVisibilityChangedCallback(),yield e._startAutoRefresh()})()}stopAutoRefresh(){var e=this;return(0,h.Z)(function*(){e._removeVisibilityChangedCallback(),yield e._stopAutoRefresh()})()}_autoRefreshTokenTick(){var e=this;return(0,h.Z)(function*(){e._debug("#_autoRefreshTokenTick()","begin");try{yield e._acquireLock(0,(0,h.Z)(function*(){try{const t=Date.now();try{return yield e._useSession(function(){var n=(0,h.Z)(function*(s){const{data:{session:o}}=s;if(!o||!o.refresh_token||!o.expires_at)return void e._debug("#_autoRefreshTokenTick()","no session");const a=Math.floor((1e3*o.expires_at-t)/ce);e._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),a<=3&&(yield e._callRefreshToken(o.refresh_token))});return function(s){return n.apply(this,arguments)}}())}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{e._debug("#_autoRefreshTokenTick()","end")}}))}catch(t){if(!(t.isAcquireTimeout||t instanceof _r))throw t;e._debug("auto refresh token tick lock not available")}})()}_handleVisibilityChange(){var e=this;return(0,h.Z)(function*(){if(e._debug("#_handleVisibilityChange()"),!Z()||null==window||!window.addEventListener)return e.autoRefreshToken&&e.startAutoRefresh(),!1;try{e.visibilityChangedCallback=(0,h.Z)(function*(){return yield e._onVisibilityChanged(!1)}),null==window||window.addEventListener("visibilitychange",e.visibilityChangedCallback),yield e._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}})()}_onVisibilityChanged(e){var t=this;return(0,h.Z)(function*(){const n=`#_onVisibilityChanged(${e})`;t._debug(n,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(t.autoRefreshToken&&t._startAutoRefresh(),e||(yield t.initializePromise,yield t._acquireLock(-1,(0,h.Z)(function*(){"visible"===document.visibilityState?yield t._recoverAndRefresh():t._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&t.autoRefreshToken&&t._stopAutoRefresh()})()}_getUrlForProvider(e,t){var n=this;return(0,h.Z)(function*(){const s=[`provider=${encodeURIComponent(e)}`];if(null!=t&&t.redirectTo&&s.push(`redirect_to=${encodeURIComponent(t.redirectTo)}`),null!=t&&t.scopes&&s.push(`scopes=${encodeURIComponent(t.scopes)}`),"pkce"===n.flowType){const o=oe();yield V(n.storage,`${n.storageKey}-code-verifier`,o);const a=yield ae(o),c=o===a?"plain":"s256";n._debug("PKCE","code verifier",`${o.substring(0,5)}...`,"code challenge",a,"method",c);const u=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(c)}`});s.push(u.toString())}if(null!=t&&t.queryParams){const o=new URLSearchParams(t.queryParams);s.push(o.toString())}return`${n.url}/authorize?${s.join("&")}`})()}_unenroll(e){var t=this;return(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;const{data:a,error:c}=s;return c?{data:null,error:c}:yield y(t.fetch,"DELETE",`${t.url}/factors/${e.factorId}`,{headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}})()}_enroll(e){var t=this;return(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o,a;const{data:c,error:u}=s;if(u)return{data:null,error:u};const{data:l,error:d}=yield y(t.fetch,"POST",`${t.url}/factors`,{body:{friendly_name:e.friendlyName,factor_type:e.factorType,issuer:e.issuer},headers:t.headers,jwt:null===(o=null==c?void 0:c.session)||void 0===o?void 0:o.access_token});return d?{data:null,error:d}:(!(null===(a=null==l?void 0:l.totp)||void 0===a)&&a.qr_code&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}})()}_verify(e){var t=this;return(0,h.Z)(function*(){return t._acquireLock(-1,(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;const{data:a,error:c}=s;if(c)return{data:null,error:c};const{data:u,error:l}=yield y(t.fetch,"POST",`${t.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token});return l?{data:null,error:l}:(yield t._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),yield t._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),{data:u,error:l})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}}))})()}_challenge(e){var t=this;return(0,h.Z)(function*(){return t._acquireLock(-1,(0,h.Z)(function*(){try{return yield t._useSession(function(){var n=(0,h.Z)(function*(s){var o;const{data:a,error:c}=s;return c?{data:null,error:c}:yield y(t.fetch,"POST",`${t.url}/factors/${e.factorId}/challenge`,{headers:t.headers,jwt:null===(o=null==a?void 0:a.session)||void 0===o?void 0:o.access_token})});return function(s){return n.apply(this,arguments)}}())}catch(n){if(v(n))return{data:null,error:n};throw n}}))})()}_challengeAndVerify(e){var t=this;return(0,h.Z)(function*(){const{data:n,error:s}=yield t._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield t._verify({factorId:e.factorId,challengeId:n.id,code:e.code})})()}_listFactors(){var e=this;return(0,h.Z)(function*(){const{data:{user:t},error:n}=yield e.getUser();if(n)return{data:null,error:n};const s=(null==t?void 0:t.factors)||[],o=s.filter(a=>"totp"===a.factor_type&&"verified"===a.status);return{data:{all:s,totp:o},error:null}})()}_getAuthenticatorAssuranceLevel(){var e=this;return(0,h.Z)(function*(){return e._acquireLock(-1,(0,h.Z)(function*(){return yield e._useSession(function(){var t=(0,h.Z)(function*(n){var s,o;const{data:{session:a},error:c}=n;if(c)return{data:null,error:c};if(!a)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const u=e._decodeJWT(a.access_token);let l=null;u.aal&&(l=u.aal);let d=l;return(null!==(o=null===(s=a.user.factors)||void 0===s?void 0:s.filter(f=>"verified"===f.status))&&void 0!==o?o:[]).length>0&&(d="aal2"),{data:{currentLevel:l,nextLevel:d,currentAuthenticationMethods:u.amr||[]},error:null}});return function(n){return t.apply(this,arguments)}}())}))})()}}return i.nextInstanceID=0,i})();class mr extends yr{constructor(r){super(r)}}const wr={headers:Lt},kr={schema:"public"},Sr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Or={};class xr{constructor(r,e,t){var n,s,o,a,c,u,l,d;if(this.supabaseUrl=r,this.supabaseKey=e,!r)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");const _=function Nt(i){return i.replace(/\/$/,"")}(r);this.realtimeUrl=`${_}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${_}/auth/v1`,this.storageUrl=`${_}/storage/v1`,this.functionsUrl=`${_}/functions/v1`;const g=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,p=function Mt(i,r){const{db:e,auth:t,realtime:n,global:s}=i,{db:o,auth:a,realtime:c,global:u}=r;return{db:Object.assign(Object.assign({},o),e),auth:Object.assign(Object.assign({},a),t),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},u),s)}}(null!=t?t:{},{db:kr,realtime:Or,auth:Object.assign(Object.assign({},Sr),{storageKey:g}),global:wr});this.storageKey=null!==(s=null===(n=p.auth)||void 0===n?void 0:n.storageKey)&&void 0!==s?s:"",this.headers=null!==(a=null===(o=p.global)||void 0===o?void 0:o.headers)&&void 0!==a?a:{},this.auth=this._initSupabaseAuthClient(null!==(c=p.auth)&&void 0!==c?c:{},this.headers,null===(u=p.global)||void 0===u?void 0:u.fetch),this.fetch=Ft(e,this._getAccessToken.bind(this),null===(l=p.global)||void 0===l?void 0:l.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},p.realtime)),this.rest=new ve(`${_}/rest/v1`,{headers:this.headers,schema:null===(d=p.db)||void 0===d?void 0:d.schema,fetch:this.fetch}),this._listenForAuthEvents()}get functions(){return new B(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ct(this.storageUrl,this.headers,this.fetch)}from(r){return this.rest.from(r)}schema(r){return this.rest.schema(r)}rpc(r,e={},t){return this.rest.rpc(r,e,t)}channel(r,e={config:{}}){return this.realtime.channel(r,e)}getChannels(){return this.realtime.getChannels()}removeChannel(r){return this.realtime.removeChannel(r)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var r,e;return function(i,r,e,t){return new(e||(e=Promise))(function(s,o){function a(l){try{u(t.next(l))}catch(d){o(d)}}function c(l){try{u(t.throw(l))}catch(d){o(d)}}function u(l){l.done?s(l.value):function n(s){return s instanceof e?s:new e(function(o){o(s)})}(l.value).then(a,c)}u((t=t.apply(i,r||[])).next())})}(this,void 0,void 0,function*(){const{data:t}=yield this.auth.getSession();return null!==(e=null===(r=t.session)||void 0===r?void 0:r.access_token)&&void 0!==e?e:null})}_initSupabaseAuthClient({autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,storageKey:s,flowType:o,debug:a},c,u){return new mr({url:this.authUrl,headers:Object.assign(Object.assign({},{Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`}),c),storageKey:s,autoRefreshToken:r,persistSession:e,detectSessionInUrl:t,storage:n,flowType:o,debug:a,fetch:u})}_initRealtimeClient(r){return new kt(this.realtimeUrl,Object.assign(Object.assign({},r),{params:Object.assign({apikey:this.supabaseKey},null==r?void 0:r.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(r,e,t){"TOKEN_REFRESHED"!==r&&"SIGNED_IN"!==r||this.changedAccessToken===t?"SIGNED_OUT"===r&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==e&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=t?t:null),this.changedAccessToken=t)}}const Tr=(i,r,e)=>new xr(i,r,e)},2150:C=>{var $=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")};C.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return $()}try{return __global__||$()}finally{delete Object.prototype.__global__}}()},6624:(C,$,m)=>{var S;if("object"==typeof globalThis)S=globalThis;else try{S=m(2150)}catch{}finally{if(!S&&typeof window<"u"&&(S=window),!S)throw new Error("Could not determine global this")}var I=S.WebSocket||S.MozWebSocket,ee=m(7490);function K(L,z){return z?new I(L,z):new I(L)}I&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(L){Object.defineProperty(K,L,{get:function(){return I[L]}})}),C.exports={w3cwebsocket:I?K:null,version:ee}},7490:(C,$,m)=>{C.exports=m(9794).version},9794:C=>{"use strict";C.exports={version:"1.0.34"}}}]);