"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9471],{9471:(w,v,a)=>{a.r(v),a.d(v,{LoginPage:()=>C});var u=a(5861),b=a(6814),l=a(95),o=a(6196),m=a(9862),e=a(6689),y=a(2333),T=a(8828),Z=a(5266),h=a(553),P=a(46);let S=(()=>{var i;class d{constructor(t,r,n){this.http=t,this.router=r,this.authService=n,this.apiUrl=h.N.supabaseUrl+"/rest/v1/profesores",this.supabase=(0,P.eI)(h.N.supabaseUrl,h.N.supabaseKey)}getProfesorInfo(t){const r=new m.WM({apikey:h.N.supabaseKey,Authorization:`Bearer ${h.N.supabaseKey}`,Range:"0-9"});return this.http.get(this.apiUrl,{headers:r,params:{id:`eq.${t}`,select:"*"}})}}return(i=d).\u0275fac=function(t){return new(t||i)(e.LFG(m.eN),e.LFG(T.F0),e.LFG(y.e))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),d})();function U(i,d){1&i&&(e.TgZ(0,"ion-note",16),e._uU(1,"Ingresa tu correo electr\xf3nico"),e.qZA())}function A(i,d){1&i&&(e.TgZ(0,"ion-note",16),e._uU(1,"Ingresa tu contrase\xf1a"),e.qZA())}let C=(()=>{var i;class d{constructor(t,r,n,s,c,f,g){this.fb=t,this.authService=r,this.loadingController=n,this.alertController=s,this.router=c,this.alumnoService=f,this.profesorService=g,this.rol=2,this.credentials=this.fb.group({email:["",l.kI.required],password:["",l.kI.required]})}ngOnInit(){this.authService.getCurrentUser().subscribe(t=>{t&&(this.userId=this.authService.getCurrentUserId(),this.alumnoService.getAlumnoInfo(this.userId).subscribe(r=>{r&&!1===this.authService.initialized&&this.redirectByRolValue(r[0].rol)}),this.profesorService.getProfesorInfo(this.userId).subscribe(r=>{r&&!1===this.authService.initialized&&this.redirectByRolValue(r[0].rol)}))}),this.credentials.get("email").setValue("combustion.2@gmail.com"),this.credentials.get("password").setValue("123456")}ionViewWillEnter(){return(0,u.Z)(function*(){})()}get email(){return this.credentials.controls.email}get password(){return this.credentials.controls.password}login(){var t=this;return(0,u.Z)(function*(){const r=yield t.loadingController.create();yield r.present(),t.authService.signIn(t.credentials.getRawValue()).then(function(){var n=(0,u.Z)(function*(s){yield r.dismiss(),s.error&&t.showAlert("Inicio de sesi\xf3n fallido",s.error.message)});return function(s){return n.apply(this,arguments)}}())})()}forgotPw(){var t=this;return(0,u.Z)(function*(){var n;yield(yield t.alertController.create({header:"Recibir una nueva contrase\xf1a",message:"Por favor, ingresa tu correo electr\xf3nico",inputs:[{type:"email",name:"email"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Restablecer contrase\xf1a",handler:(n=(0,u.Z)(function*(s){const c=yield t.loadingController.create();yield c.present();const{error:g}=yield t.authService.sendPwReset(s.email);yield c.dismiss(),g?t.showAlert("Error","Por favor, ingresa tu correo electr\xf3nico"):t.showAlert("\xc9xito","\xa1Por favor, revisa tu correo electr\xf3nico para obtener m\xe1s instrucciones!")}),function(c){return n.apply(this,arguments)})}]})).present()})()}getMagicLink(){var t=this;return(0,u.Z)(function*(){var n;yield(yield t.alertController.create({header:"Obtener un Enlace M\xe1gico",message:"\xa1Te enviaremos un enlace para iniciar sesi\xf3n de manera m\xe1gica!",inputs:[{type:"email",name:"email"}],buttons:[{text:"Cancelar",role:"cancel"},{text:"Obtener Enlace M\xe1gico",handler:(n=(0,u.Z)(function*(s){const c=yield t.loadingController.create();yield c.present();const{data:f,error:g}=yield t.authService.signInWithEmail(s.email);yield c.dismiss(),console.log("despu\xe9s de registrarse: ",f),console.log("error despu\xe9s de registrarse: ",g),g?t.showAlert("Error",g.message):t.showAlert("\xc9xito","\xa1Por favor, revisa tu correo electr\xf3nico para obtener m\xe1s instrucciones!")}),function(c){return n.apply(this,arguments)})}]})).present()})()}showAlert(t,r){var n=this;return(0,u.Z)(function*(){yield(yield n.alertController.create({header:t,message:r,buttons:["OK"]})).present()})()}redirectByRolValue(t){1===t?this.goToStudentTabs():2===t&&this.goToTeacherTabs(),this.authService.setInizializedToTrue()}goToStudentTabs(){this.authService.initialized||this.router.navigate(["student","tabs","tab1"])}goToTeacherTabs(){this.router.navigate(["teacher","tabs","tab1"])}goToRegister(){this.router.navigate(["register"])}}return(i=d).\u0275fac=function(t){return new(t||i)(e.Y36(l.qu),e.Y36(y.e),e.Y36(o.HT),e.Y36(o.Br),e.Y36(T.F0),e.Y36(Z.X),e.Y36(S))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-login"]],standalone:!0,features:[e.jDz],decls:30,vars:4,consts:[["color","primary"],["scrollY","false"],[1,"animate__animated","animate__fadeInUp"],[3,"formGroup","ngSubmit"],["position","stacked"],["type","email","inputmode","email","placeholder","Ingresa tu correo electr\xf3nico","formControlName","email"],["slot","error",4,"ngIf"],["type","password","placeholder","Ingresa tu contrase\xf1a","formControlName","password"],["type","submit","expand","block","strong","true",3,"disabled"],[1,"ion-margin-top"],["type","button","expand","block","color","primary","fill","outline",3,"click"],["name","person-outline","slot","start"],["type","button","expand","block","color","secondary",3,"click"],["name","key-outline","slot","start"],["type","button","expand","block","color","tertiary",3,"click"],["name","mail-outline","slot","start"],["slot","error"]],template:function(t,r){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3,"RegistrAPP1 - 1"),e.qZA()()(),e.TgZ(4,"ion-content",1)(5,"ion-card",2)(6,"ion-card-content")(7,"form",3),e.NdJ("ngSubmit",function(){return r.login()}),e.TgZ(8,"ion-item")(9,"ion-label",4),e._uU(10,"Correo electr\xf3nico"),e.qZA(),e._UZ(11,"ion-input",5),e.YNc(12,U,2,0,"ion-note",6),e.qZA(),e.TgZ(13,"ion-item")(14,"ion-label",4),e._uU(15,"Contrase\xf1a"),e.qZA(),e._UZ(16,"ion-input",7),e.YNc(17,A,2,0,"ion-note",6),e.qZA(),e.TgZ(18,"ion-button",8),e._uU(19,"Ingresar"),e.qZA(),e.TgZ(20,"div",9)(21,"ion-button",10),e.NdJ("click",function(){return r.goToRegister()}),e._UZ(22,"ion-icon",11),e._uU(23," Registrarse "),e.qZA(),e.TgZ(24,"ion-button",12),e.NdJ("click",function(){return r.forgotPw()}),e._UZ(25,"ion-icon",13),e._uU(26," \xbfOlvidaste tu contrase\xf1a? "),e.qZA(),e.TgZ(27,"ion-button",14),e.NdJ("click",function(){return r.getMagicLink()}),e._UZ(28,"ion-icon",15),e._uU(29," Ingresa con Email "),e.qZA()()()()()()),2&t&&(e.xp6(7),e.Q6J("formGroup",r.credentials),e.xp6(5),e.Q6J("ngIf",(r.email.dirty||r.email.touched)&&r.email.errors),e.xp6(5),e.Q6J("ngIf",(r.password.dirty||r.password.touched)&&r.password.errors),e.xp6(1),e.Q6J("disabled",!r.credentials.valid))},dependencies:[o.Pc,o.YG,o.PM,o.FN,o.W2,o.Gu,o.gu,o.pK,o.Ie,o.Q$,o.uN,o.wd,o.sr,o.j9,b.ez,b.O5,l.u5,l._Y,l.JJ,l.JL,l.UX,l.sg,l.u,m.JF],styles:["ion-content[_ngcontent-%COMP%]{--padding-top: 20%;--padding-start: 5%;--padding-end: 5%;--background: linear-gradient(rgba(0, 0, 0, .6), rgba(0, 0, 0, .7)), url(https://images.unsplash.com/photo-1508964942454-1a56651d54ac?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1035&q=80) no-repeat}"]}),d})()}}]);